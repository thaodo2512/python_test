{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Compact Numeric Sensor PDR Schema (DSP0248 1.3.0, Clause 28.25)",
  "type": "object",
  "additionalProperties": false,
  "binaryOrder": [
    "PLDMTerminusHandle",
    "sensorID",
    "entityType",
    "entityInstanceNumber",
    "containerID",
    "sensorNameStringByteLength",
    "baseUnit",
    "unitModifier",
    "rateUnit",
    "rangeFieldSupport",
    "warningHigh",
    "warningLow",
    "criticalHigh",
    "criticalLow",
    "fatalHigh",
    "fatalLow",
    "sensorNameString"
  ],
  "properties": {
    "pdrHeader": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "recordHandle": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "integer",
              "minimum": 0,
              "maximum": 4294967295
            }
          ],
          "binaryFormat": "I",
          "description": "uint32; opaque handle (TBD or auto-generated)"
        },
        "PDRHeaderVersion": {
          "type": "integer",
          "const": 1,
          "binaryFormat": "B",
          "description": "uint8; must be 1"
        },
        "PDRType": {
          "type": "integer",
          "const": 21,
          "binaryFormat": "B",
          "description": "uint8; Compact Numeric Sensor PDR = 21"
        },
        "recordChangeNumber": {
          "type": "integer",
          "minimum": 0,
          "maximum": 65535,
          "default": 0,
          "binaryFormat": "H",
          "description": "uint16; incremented on changes (default 0)"
        },
        "dataLength": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "integer",
              "minimum": 0,
              "maximum": 65535
            }
          ],
          "binaryFormat": "H",
          "description": "uint16; calculated data length (TBD)"
        }
      },
      "required": [
        "recordHandle",
        "PDRHeaderVersion",
        "PDRType",
        "recordChangeNumber",
        "dataLength"
      ]
    },
    "PLDMTerminusHandle": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; Handle identifying the PLDM terminus to which the sensor belongs."
    },
    "sensorID": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; unique sensor identifier within the terminus."
    },
    "entityType": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; Type of managed entity (see 9.1)."
    },
    "entityInstanceNumber": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; Instance number of the entity (see 9.1)."
    },
    "containerID": {
      "type": "integer",
      "minimum": 0,
      "maximum": 65535,
      "binaryFormat": "H",
      "description": "uint16; Container entity ID (see 9.1)."
    },
    "sensorNameStringByteLength": {
      "type": "integer",
      "minimum": 0,
      "maximum": 255,
      "binaryFormat": "B",
      "description": "uint8; If > 0, a UTF-8 sensorNameString follows. Max recommended: 96 bytes."
    },
    "baseUnit": {
      "type": "integer",
      "minimum": 0,
      "maximum": 255,
      "binaryFormat": "B",
      "description": "enum8; Base unit of reading (e.g., Volts, Amps). See Table 75."
    },
    "unitModifier": {
      "type": "integer",
      "minimum": -128,
      "maximum": 127,
      "binaryFormat": "b",
      "description": "sint8; Power-of-10 multiplier (e.g., -6 = micro-). See 27.4."
    },
    "rateUnit": {
      "type": "integer",
      "enum": [
        0,
        1,
        2,
        3,
        4,
        5,
        6,
        7,
        8,
        9
      ],
      "binaryFormat": "B",
      "description": "enum8; Rate qualification: 0=None, 1=Per MicroSecond, 2=Per MilliSecond, 3=Per Second, 4=Per Minute, 5=Per Hour, 6=Per Day, 7=Per Week, 8=Per Month, 9=Per Year."
    },
    "rangeFieldSupport": {
      "type": "integer",
      "minimum": 0,
      "maximum": 255,
      "binaryFormat": "B",
      "description": "bitfield8; Supported range fields: bit0=warningHigh, bit1=warningLow, bit2=criticalHigh, bit3=criticalLow, bit4=fatalHigh, bit5=fatalLow, bit6-7=reserved."
    },
    "warningHigh": {
      "type": "integer",
      "minimum": -2147483648,
      "maximum": 2147483647,
      "binaryFormat": "i",
      "conditional": {
        "group": "range",
        "bit": 0
      },
      "description": "sint32; Upper warning threshold (value > this → warning). Expressed in sensor units."
    },
    "warningLow": {
      "type": "integer",
      "minimum": -2147483648,
      "maximum": 2147483647,
      "binaryFormat": "i",
      "conditional": {
        "group": "range",
        "bit": 1
      },
      "description": "sint32; Lower warning threshold (value ≤ this → warning)."
    },
    "criticalHigh": {
      "type": "integer",
      "minimum": -2147483648,
      "maximum": 2147483647,
      "binaryFormat": "i",
      "conditional": {
        "group": "range",
        "bit": 2
      },
      "description": "sint32; Upper critical threshold (value ≥ this → critical)."
    },
    "criticalLow": {
      "type": "integer",
      "minimum": -2147483648,
      "maximum": 2147483647,
      "binaryFormat": "i",
      "conditional": {
        "group": "range",
        "bit": 3
      },
      "description": "sint32; Lower critical threshold (value < this → critical)."
    },
    "fatalHigh": {
      "type": "integer",
      "minimum": -2147483648,
      "maximum": 2147483647,
      "binaryFormat": "i",
      "conditional": {
        "group": "range",
        "bit": 4
      },
      "description": "sint32; Upper fatal threshold (value > this → fatal)."
    },
    "fatalLow": {
      "type": "integer",
      "minimum": -2147483648,
      "maximum": 2147483647,
      "binaryFormat": "i",
      "conditional": {
        "group": "range",
        "bit": 5
      },
      "description": "sint32; Lower fatal threshold (value < this → fatal)."
    },
    "sensorNameString": {
      "type": "string",
      "binaryFormat": "variable",
      "description": "strUTF-8; Conditional: Present only if sensorNameStringByteLength > 0. UTF-8 null-terminated string of exactly that length. Used for display."
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "sensorNameStringByteLength": {
            "exclusiveMinimum": 0
          }
        }
      },
      "then": {
        "required": ["sensorNameString"]
      }
    }
  ],
  "required": [
    "pdrHeader",
    "PLDMTerminusHandle",
    "sensorID",
    "entityType",
    "entityInstanceNumber",
    "containerID",
    "sensorNameStringByteLength",
    "baseUnit",
    "unitModifier",
    "rateUnit",
    "rangeFieldSupport"
  ]
}